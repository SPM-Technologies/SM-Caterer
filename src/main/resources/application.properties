# ===================================
# APPLICATION CONFIGURATION
# ===================================
spring.application.name=SM-Caterer

# ===================================
# SERVER CONFIGURATION
# ===================================
server.port=8080
server.error.include-message=always
server.error.include-binding-errors=always
server.error.whitelabel.enabled=false

# ===================================
# DATABASE CONFIGURATION
# ===================================
# SECURITY: Use environment variables in production
spring.datasource.url=${DB_URL:jdbc:mysql://localhost:3306/sm-caterer?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC}
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:Pass@12345}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ===================================
# HIKARICP CONNECTION POOL
# ===================================
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.pool-name=SM-Caterer-HikariCP

# ===================================
# JPA / HIBERNATE CONFIGURATION
# ===================================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# Performance Optimizations
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Cache Settings (disabled for now)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# Query Statistics (for performance monitoring)
spring.jpa.properties.hibernate.generate_statistics=false

# ===================================
# FLYWAY CONFIGURATION
# ===================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false
# Ignore failed migrations during validation (allows recovery from partial failures)
spring.flyway.ignore-migration-patterns=*:failed

# ===================================
# ACTUATOR CONFIGURATION
# ===================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.hikaricp=true

# ===================================
# LOGGING CONFIGURATION (PRODUCTION-SAFE)
# ===================================
logging.level.root=INFO
logging.level.com.smtech=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO

# Database Logging (SAFE - No parameter values)
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql=INFO
# SECURITY: TRACE logging REMOVED - it would expose passwords and PII in logs

# Slow Query Logging
logging.level.org.hibernate.SQL_SLOW=WARN

# Logging Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log Files
logging.file.name=logs/sm-caterer.log
logging.file.max-size=10MB
logging.file.max-history=30

# ===================================
# VALIDATION CONFIGURATION
# ===================================
spring.validation.enabled=true

# ===================================
# JACKSON CONFIGURATION
# ===================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null

# ===================================
# PHASE 2: JWT CONFIGURATION
# ===================================
# Secret key for JWT signing (256-bit minimum for HS512)
# SECURITY: Set JWT_SECRET environment variable in production
jwt.secret=${JWT_SECRET:CloudCatersDevSecretKey256BitsMinimumForHS512Algorithm2024SecureToken!@#$}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}
jwt.header=Authorization
jwt.prefix=Bearer

# ===================================
# PHASE 2: CORS CONFIGURATION
# ===================================
cors.allowed-origins=http://localhost:3000,http://localhost:8080
cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin
cors.allow-credentials=true
cors.max-age=3600

# ===================================
# PHASE 2: RATE LIMITING
# ===================================
rate-limit.enabled=true
rate-limit.requests-per-minute.unauthenticated=100
rate-limit.requests-per-minute.authenticated=500
rate-limit.requests-per-minute.admin=1000

# ===================================
# PHASE 2: OPENAPI / SWAGGER
# ===================================
# SECURITY: Disable Swagger in production by setting SWAGGER_ENABLED=false
springdoc.api-docs.enabled=${SWAGGER_ENABLED:true}
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.enabled=${SWAGGER_ENABLED:true}
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
# SECURITY: Disable try-it-out in production by setting SWAGGER_TRY_IT_OUT=false
springdoc.swagger-ui.try-it-out-enabled=${SWAGGER_TRY_IT_OUT:true}
springdoc.show-actuator=false

# ===================================
# PHASE 2: SECURITY SETTINGS
# ===================================
# Account lockout settings
security.login.max-attempts=5
security.login.lockout-duration-minutes=30

# Password policy
security.password.min-length=8
security.password.require-uppercase=true
security.password.require-lowercase=true
security.password.require-digit=true
security.password.require-special=false

# Session settings - NOT USED with stateless JWT authentication
# These are commented out because SecurityConfig uses SessionCreationPolicy.STATELESS
# Uncomment only if switching to session-based authentication
# server.servlet.session.timeout=30m
# server.servlet.session.cookie.http-only=true
# server.servlet.session.cookie.secure=false

# ===================================
# PHASE 2: SECURITY LOGGING
# ===================================
# SECURITY: In production, set these to INFO to avoid PII in logs
# PII (usernames, emails) are only logged at DEBUG level
logging.level.org.springframework.security=${SECURITY_LOG_LEVEL:DEBUG}
logging.level.com.smtech.SM_Caterer.security=${SECURITY_LOG_LEVEL:DEBUG}
logging.level.com.smtech.SM_Caterer.API=${API_LOG_LEVEL:DEBUG}
logging.level.com.smtech.SM_Caterer.service=${SERVICE_LOG_LEVEL:DEBUG}

# ===================================
# PHASE 3: THYMELEAF CONFIGURATION
# ===================================
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.cache=${THYMELEAF_CACHE:false}
spring.thymeleaf.check-template-location=true
spring.thymeleaf.enable-spring-el-compiler=true

# ===================================
# PHASE 3: STATIC RESOURCES
# ===================================
spring.web.resources.static-locations=classpath:/static/,classpath:/public/
spring.web.resources.cache.period=3600
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**

# ===================================
# PHASE 3: SESSION CONFIGURATION (For Web UI)
# ===================================
server.servlet.session.cookie.name=SMCATERER_SESSION
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=${SESSION_SECURE:false}
server.servlet.session.timeout=30m
server.servlet.session.tracking-modes=cookie

# ===================================
# PHASE 3: INTERNATIONALIZATION (i18n)
# ===================================
spring.messages.basename=messages/messages
spring.messages.encoding=UTF-8
spring.messages.fallback-to-system-locale=false
spring.messages.cache-duration=3600

# ===================================
# PHASE 3: THYMELEAF LOGGING
# ===================================
logging.level.org.thymeleaf=INFO

# ===================================
# PHASE 3: REMEMBER-ME CONFIGURATION
# ===================================
# SECURITY: Set REMEMBER_ME_KEY environment variable in production
security.remember-me.key=${REMEMBER_ME_KEY:smcaterer-dev-remember-me-key-2024}
security.remember-me.validity-seconds=604800
